import{r as i,j as e}from"./index-Cra2tMKZ.js";import{g as E,c as N,u as Y,d as g,a as $,q as D,w as F,b as M,r as B,e as P,f as Q,s as q}from"./firebase-C73fepr0.js";import{d as o,E as T,s as W}from"./EventManager-CRCWZB0X.js";import"./index-68602d24-Cqehjd0e.js";import"./firebaseConfig-YO4LmEVF.js";const z=()=>{const[j,b]=i.useState([]),[l,u]=i.useState(null),[d,m]=i.useState(""),v=async()=>{const n=(await E(N(o,"users"))).docs.map(f=>({id:f.id,...f.data()}));b(n)},y=async()=>{if(!(!l||!d))try{await Y(g(o,"users",l.id),{role:d}),v(),u(null),m("")}catch(r){console.error("Error updating user role:",r)}};return i.useEffect(()=>{v()},[]),e.jsxs("div",{className:"user-manager",children:[e.jsx("h3",{children:"User Manager"}),e.jsx("h4",{children:"Existing Users"}),e.jsx("ul",{children:j.map(r=>e.jsxs("li",{children:[e.jsxs("h5",{children:[r.email," - Role: ",r.role]}),e.jsx("button",{onClick:()=>u(r),children:"Change Role"})]},r.id))}),l&&e.jsxs("div",{children:[e.jsxs("h5",{children:["Change Role for ",l.email]}),e.jsxs("select",{value:d,onChange:r=>m(r.target.value),children:[e.jsx("option",{value:"",children:"Select Role"}),e.jsx("option",{value:"member",children:"Member"}),e.jsx("option",{value:"secretary",children:"Secretary"}),e.jsx("option",{value:"treasurer",children:"Treasurer"}),e.jsx("option",{value:"chairman",children:"Chairman"})]}),e.jsx("button",{onClick:y,children:"Update Role"})]})]})},V=()=>{const[j,b]=i.useState([]),[l,u]=i.useState([]),[d,m]=i.useState(null),[v,y]=i.useState(!0),[r,n]=i.useState(""),[f,S]=i.useState(""),[U,C]=i.useState(!1),[R,L]=i.useState([]),s=$.currentUser;i.useEffect(()=>{const t=async()=>{if(s){y(!0);try{const c=D(N(o,"activities"),F("userId","==",s.uid)),w=await E(c),x=[];w.forEach(p=>{x.push({...p.data(),id:p.id})}),b(x)}catch(c){console.error("Error fetching activities:",c),n("Failed to load activities.")}finally{y(!1)}}},a=async()=>{if(s)try{const c=await M(g(o,"certificates",s.uid));c.exists()?u([c.data()]):console.log("No certificates found!")}catch(c){console.error("Error fetching certificates:",c),n("Failed to load certificates.")}},h=async()=>{if(s)try{const c=D(N(o,"events"),F("date",">=",new Date)),w=await E(c),x=[];w.forEach(p=>{x.push({...p.data(),id:p.id})}),L(x)}catch(c){console.error("Error fetching events:",c),n("Failed to load events.")}};t(),a(),h()},[s]);const k=t=>{var h;const a=(h=t.target.files)==null?void 0:h[0];a&&m(a)},A=async()=>{if(d){const t=B(W,`certificates/${s==null?void 0:s.uid}/${d.name}`);C(!0);try{await P(t,d);const a=await Q(t);await q(g(o,"certificates",s.uid),{url:a,userId:s.uid}),m(null),S("Certificate uploaded successfully!");const h=await M(g(o,"certificates",s.uid));h.exists()&&u([h.data()])}catch(a){console.error("Error uploading certificate:",a),n("Failed to upload certificate.")}finally{C(!1)}}else n("Please select a file to upload.")},I=async t=>{try{const a=g(N(o,"participations"));await q(a,{eventId:t,userId:s.uid,date:new Date}),S("You have registered for the event!")}catch(a){console.error("Error registering for event:",a),n("Failed to register for the event.")}};return e.jsxs("div",{className:"dashboard-container p-6 bg-white rounded-lg shadow-md",children:[e.jsxs("h2",{className:"text-2xl font-bold",children:["Welcome, ",s==null?void 0:s.displayName]}),e.jsxs("p",{className:"text-gray-600",children:["Email: ",s==null?void 0:s.email]}),v?e.jsx("p",{children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"activities mt-4",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Your Activities"}),j.length>0?e.jsx("ul",{className:"list-disc ml-6",children:j.map(t=>e.jsx("li",{className:"my-2 p-2 border rounded",children:t.title},t.id))}):e.jsx("p",{children:"No activities found."})]}),e.jsxs("div",{className:"certificates mt-4",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Your Certificates"}),l.length>0?e.jsx("ul",{className:"list-disc ml-6",children:l.map((t,a)=>e.jsx("li",{className:"my-2 p-2 border rounded",children:e.jsx("a",{href:t.url,className:"text-blue-500 underline",download:!0,children:"Download Certificate"})},a))}):e.jsx("p",{children:"No certificates found."})]}),e.jsxs("div",{className:"upload-certificate mt-4",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Upload Certificate"}),e.jsx("input",{type:"file",onChange:k,className:"border rounded p-2 w-full"}),e.jsx("button",{onClick:A,disabled:U,className:"mt-2 p-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:U?"Uploading...":"Upload"})]}),e.jsxs("div",{className:"upcoming-events mt-4",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Upcoming Events"}),R.length>0?e.jsx("ul",{className:"list-disc ml-6",children:R.map(t=>e.jsxs("li",{className:"my-2 p-2 border rounded",children:[t.name," - ",t.date,e.jsx("button",{onClick:()=>I(t.id),className:"ml-4 p-1 bg-green-500 text-white rounded",children:"Register"})]},t.id))}):e.jsx("p",{children:"No upcoming events found."})]}),r&&e.jsx("p",{className:"mt-4 text-red-500",children:r}),f&&e.jsx("p",{className:"mt-4 text-green-500",children:f}),(s==null?void 0:s.role)==="chairman"&&e.jsxs(e.Fragment,{children:[e.jsx(T,{}),e.jsx(z,{})]})]})]})};export{V as default};
