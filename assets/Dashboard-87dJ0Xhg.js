import{r as i,j as e}from"./index-C6I2w2Bd.js";import{g as E,c as N,d as l,u as Y,a as g,b as $,E as B,q as D,w as F,e as M,r as P,s as Q,f as T,h as W,i as q}from"./EventManager-DqmHzjcU.js";import"./firebaseConfig-Cxgwzx5L.js";const z=()=>{const[j,b]=i.useState([]),[o,u]=i.useState(null),[d,m]=i.useState(""),v=async()=>{const n=(await E(N(l,"users"))).docs.map(f=>({id:f.id,...f.data()}));b(n)},y=async()=>{if(!(!o||!d))try{await Y(g(l,"users",o.id),{role:d}),v(),u(null),m("")}catch(r){console.error("Error updating user role:",r)}};return i.useEffect(()=>{v()},[]),e.jsxs("div",{className:"user-manager",children:[e.jsx("h3",{children:"User Manager"}),e.jsx("h4",{children:"Existing Users"}),e.jsx("ul",{children:j.map(r=>e.jsxs("li",{children:[e.jsxs("h5",{children:[r.email," - Role: ",r.role]}),e.jsx("button",{onClick:()=>u(r),children:"Change Role"})]},r.id))}),o&&e.jsxs("div",{children:[e.jsxs("h5",{children:["Change Role for ",o.email]}),e.jsxs("select",{value:d,onChange:r=>m(r.target.value),children:[e.jsx("option",{value:"",children:"Select Role"}),e.jsx("option",{value:"member",children:"Member"}),e.jsx("option",{value:"secretary",children:"Secretary"}),e.jsx("option",{value:"treasurer",children:"Treasurer"}),e.jsx("option",{value:"chairman",children:"Chairman"})]}),e.jsx("button",{onClick:y,children:"Update Role"})]})]})},K=()=>{const[j,b]=i.useState([]),[o,u]=i.useState([]),[d,m]=i.useState(null),[v,y]=i.useState(!0),[r,n]=i.useState(""),[f,S]=i.useState(""),[U,C]=i.useState(!1),[R,L]=i.useState([]),s=$.currentUser;i.useEffect(()=>{const t=async()=>{if(s){y(!0);try{const c=D(N(l,"activities"),F("userId","==",s.uid)),w=await E(c),x=[];w.forEach(p=>{x.push({...p.data(),id:p.id})}),b(x)}catch(c){console.error("Error fetching activities:",c),n("Failed to load activities.")}finally{y(!1)}}},a=async()=>{if(s)try{const c=await M(g(l,"certificates",s.uid));c.exists()?u([c.data()]):console.log("No certificates found!")}catch(c){console.error("Error fetching certificates:",c),n("Failed to load certificates.")}},h=async()=>{if(s)try{const c=D(N(l,"events"),F("date",">=",new Date)),w=await E(c),x=[];w.forEach(p=>{x.push({...p.data(),id:p.id})}),L(x)}catch(c){console.error("Error fetching events:",c),n("Failed to load events.")}};t(),a(),h()},[s]);const k=t=>{var h;const a=(h=t.target.files)==null?void 0:h[0];a&&m(a)},A=async()=>{if(d){const t=P(Q,`certificates/${s==null?void 0:s.uid}/${d.name}`);C(!0);try{await T(t,d);const a=await W(t);await q(g(l,"certificates",s.uid),{url:a,userId:s.uid}),m(null),S("Certificate uploaded successfully!");const h=await M(g(l,"certificates",s.uid));h.exists()&&u([h.data()])}catch(a){console.error("Error uploading certificate:",a),n("Failed to upload certificate.")}finally{C(!1)}}else n("Please select a file to upload.")},I=async t=>{try{const a=g(N(l,"participations"));await q(a,{eventId:t,userId:s.uid,date:new Date}),S("You have registered for the event!")}catch(a){console.error("Error registering for event:",a),n("Failed to register for the event.")}};return e.jsxs("div",{className:"dashboard-container p-6 bg-white rounded-lg shadow-md",children:[e.jsxs("h2",{className:"text-2xl font-bold",children:["Welcome, ",s==null?void 0:s.displayName]}),e.jsxs("p",{className:"text-gray-600",children:["Email: ",s==null?void 0:s.email]}),v?e.jsx("p",{children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"activities mt-4",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Your Activities"}),j.length>0?e.jsx("ul",{className:"list-disc ml-6",children:j.map(t=>e.jsx("li",{className:"my-2 p-2 border rounded",children:t.title},t.id))}):e.jsx("p",{children:"No activities found."})]}),e.jsxs("div",{className:"certificates mt-4",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Your Certificates"}),o.length>0?e.jsx("ul",{className:"list-disc ml-6",children:o.map((t,a)=>e.jsx("li",{className:"my-2 p-2 border rounded",children:e.jsx("a",{href:t.url,className:"text-blue-500 underline",download:!0,children:"Download Certificate"})},a))}):e.jsx("p",{children:"No certificates found."})]}),e.jsxs("div",{className:"upload-certificate mt-4",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Upload Certificate"}),e.jsx("input",{type:"file",onChange:k,className:"border rounded p-2 w-full"}),e.jsx("button",{onClick:A,disabled:U,className:"mt-2 p-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:U?"Uploading...":"Upload"})]}),e.jsxs("div",{className:"upcoming-events mt-4",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Upcoming Events"}),R.length>0?e.jsx("ul",{className:"list-disc ml-6",children:R.map(t=>e.jsxs("li",{className:"my-2 p-2 border rounded",children:[t.name," - ",t.date,e.jsx("button",{onClick:()=>I(t.id),className:"ml-4 p-1 bg-green-500 text-white rounded",children:"Register"})]},t.id))}):e.jsx("p",{children:"No upcoming events found."})]}),r&&e.jsx("p",{className:"mt-4 text-red-500",children:r}),f&&e.jsx("p",{className:"mt-4 text-green-500",children:f}),(s==null?void 0:s.role)==="chairman"&&e.jsxs(e.Fragment,{children:[e.jsx(B,{}),e.jsx(z,{})]})]})]})};export{K as default};
